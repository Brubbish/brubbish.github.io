---
title: 课设-药店管理系统
tags: 作业
abbrlink: 13498
date: 2020-02-23 19:33:22
---
（为了避免又发生某种奇怪的错误导致程序突然变成了前几个小时保存的版本，还是做完后把它弄到这来好了）  
一个功能简单的管理系统，包含了menu()里的功能以及登录、注册和称不上加密的加密  

尝试使用了system("pause")、system("cls")以及把黑框弄成白框的system("color 70")
<!--more-->
```c
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<conio.h>
/*

用于测试数据： 
1234 哇 123 处 2000 2029 10
2344 吃 232 非 1234 2099 1
1233 啊 1234 非 2019 2020 2
1239 非 129 处 2001 2021 13
1342 哦哦、 23 处 2011 2022 13
3244 ·· 243 非 2011 2021 2 

*/
struct med {
	int elecode;//编码
	char name[10];// 药品名称
	double price;//价格
	char type[5];// 药品类型
	int prod;//生产日期(年)
	int shelf;//保质期(年)
	int stock;//库存
	struct med* next;

};
struct med *p;
void menu() {
	printf("欢迎使用本管理系统\n" 
			"选择一项功能:\n"
	       "1.录入信息\n"
	       "2.打印信息\n"
	       "3.保存信息\n"
	       "4.读取信息\n"
	       "5.统计药品总数\n"
	       "6.查找符合条件的药品\n"
	       "7.修改信息\n"
	       "8.删除信息\n"
	       "9.退出\n");
}
void remove();
void build();
void print(struct med *p);
void sum(struct med *p);
void save(struct med *p);
void find(struct med *p);
void modify(struct med *p);
void read();
int user();

int main() {
	system("color 70");
	int n;
	while(user()!=1){
		continue;
	}
	while(1) {
		menu();
		scanf("%d",&n);
		switch(n) {
			case 9:
				return 0;
			case 1://录入
				build();
				break;
			case 2://打印
				print(p);
				break;
			case 3://保存
				save(p);
				break;
			case 4://读取
				read();
				break;
			case 5://统计人数
				sum(p);
				break;
			case 6://查找
				find(p);
				break;
			case 7://修改
				modify(p);
				break;
			case 8://删除
				remove();
				break;
			default:
				printf("Wrong num\n");
				getchar();
				getchar();
				system("cls");
				continue;
		}
	}

}

int user(){
	int n;
	printf("欢迎使用本系统，请先注册或登录：\n");
	printf("1.注册/2.登录：");
	scanf("%d",&n);
	char id[10],pass[10];
	if(n==1) {
		printf("输入:用户名  密码:  (均只能为小于8位的字母或数字)");
		scanf("%s %s",id,pass);
		FILE* fp;
		fp = fopen(".\\userinfo.txt", "a");
		for(int i=0; id[i]!='\0'; i++) {
			id[i]+=2;
		}
		for(int i=0; pass[i]!='\0'; i++) {
			pass[i]+=2;
		}
		fprintf(fp,"%s ",id);
		fprintf(fp,"%s ",pass);
		fclose(fp);
		printf("保存成功\n");
system("pause");
		system("cls");
		return 0;
	}
	if(n==2) {
		FILE *fp;
		fp=fopen(".\\userinfo.txt","r");
		if(fp==NULL) {
			printf("还未注册过");
		} else {
			printf("输入用户名: ");
			char a[10],b[10];
			scanf("%s",a);
			for(int i=0; a[i]!='\0'; i++) {
				a[i]+=2;
			}
			printf("输入密码：");
			for(int g=0; g<10; g++) {
				b[g]=getch();
				if (b[g]=='\x0d') {
					b[g]='\0';
					break;
				}
				b[g]=b[g]+2;
				printf("*");
			}
			while(fscanf(fp,"%s",id)==1) {
				if(strcmp(id,a)==0) {
					fscanf(fp,"%s",pass);
					if(strcmp(pass,b)==0) {
						printf("正在进入管理系统....");
						system("pause");
						system("cls");
						return 1;
					}
				}
			}
			printf("用户名或密码错误");
			system("pause");
			system("cls");
		}
		return 0;
	}
}

void build() {
	struct med *head=NULL,*nextp;
	if(p!=NULL) {
		head=p;
		while(head->next!=NULL) {
			head=head->next;
		}
	}
	printf("顺序输入药品的：编码  名称 价格 药品类型（处方药/非处方药） 生产日期（年） 保质期（年） 库存，-1结束\n");
	nextp=(struct med*)malloc(sizeof(struct med));
	nextp->next=NULL;
	scanf("%d",&nextp->elecode);
	while(nextp->elecode!=-1) {
		scanf("%s %lf %s %d %d %d",nextp->name,&nextp->price,nextp->type,&nextp->prod,&nextp->shelf,&nextp->stock);
		if(head==NULL) {
			p=nextp;
			head=p;
		} else {
			head->next=nextp;
			head=head->next;
		}
		nextp=(struct med*)malloc(sizeof(struct med));
		nextp->next=NULL;
		scanf("%d",&nextp->elecode);
	}
	printf("成功录入,按回车返回");
    system("pause");
	system("cls");
}
void print(struct med *p) {	
	system("cls");
printf("编码     名称   价格    药品类型 生产日期（年） 保质期（年） 库存\n");
	while(p) {
		printf("%d     %s     %.2lf %5s %10d %10d %14d\n",p->elecode,p->name,p->price,p->type,p->prod,p->shelf,p->stock);
		p=p->next;
	}
}

void sum(struct med *p) {

	int sum=0;
	int i=0;
	while(p) {
		sum+=p->stock;
		p=p->next;
		i++;
	}
	printf("药品种类：%d\n药品总量：%d",i,sum);
    system("pause");
	system("cls");

}

//组合查询：stock>10的
//单项查询：按编码  按价格区间

void find(struct med *p) {
	printf("选择查询内容：\n1.库存小于10或可能在一年内过期的药\n2.按编码查询\n3.按价格区间查询\n");
	int n;
	int num;
	scanf("%d",&num);
	if(num==1) {
		printf("今年是__年：    ");
		scanf("%d",&n);
		printf("编码     名称   价格    药品类型 生产日期（年） 保质期（年） 库存\n");
		while(p) {
			if(p->stock<10||p->shelf-n<2)
				printf("%d     %s     %.2lf %5s %10d %10d %14d\n",p->elecode,p->name,p->price,p->type,p->prod,p->shelf,p->stock);
				//printf("%d %s %lf %s %d %d %d\n",p->elecode,p->name,p->price,p->type,p->prod,p->shelf,p->stock);
			p=p->next; 
		}
	}

	else if(num==2) {
		printf("输入编码：   ");
		scanf("%d",&n);
		printf("名称   价格    药品类型 生产日期（年） 保质期（年） 库存\n");
		while(1) {
			if(p->elecode==n) {
				break;
			}
			p=p->next;
			if(p==NULL)
				break;
		}
		if(p!=NULL)
			printf("%s     %.2lf %5s %10d %10d %14d\n",p->name,p->price,p->type,p->prod,p->shelf,p->stock);
		else
			printf("Wrong Number\n");
	}
	else if(num==3) {
		int min,max;
		printf("输入最低和最高价格，以空格分开：    ");
		scanf("%d %d",&min,&max);
		printf("编码     名称   价格    药品类型 生产日期（年） 保质期（年） 库存\n");
		while(p) {
			if(p->price>=min&&p->price<=max)
				printf("%d     %s     %.2lf %5s %10d %10d %14d\n",p->elecode,p->name,p->price,p->type,p->prod,p->shelf,p->stock);
			p=p->next;
		}
	} 
	else
		printf("错误的选项\n");
    system("pause");
	system("cls");
}


void modify(struct med *p) {
	int num;
	printf("输入修改药品的编码:\n");
	scanf("%d",&num);
	while(p) {
		if(p->elecode!=num) {
			p=p->next;
		} else
			break;
	}
	if(p==NULL)
		printf("编码错误");
	else {
		printf("输入修改药品信息:\n");	
		printf("顺序输入药品的：名称 价格 药品类型（处方药/非处方药） 生产日期（年） 保质期（年） 库存\n");
		scanf("%s %lf %s %d %d %d",p->name,&p->price,p->type,&p->prod,&p->shelf,&p->stock);
		printf("成功修改\n");
	}
system("pause");
	system("cls");
}

void remove() {
	printf("输入删除药品编码：");
	int n;
	scanf("%d",&n);
	struct med *head,*nextp,*d;
	head=p;
	nextp=p;
	if(head->elecode==n) {
		p=p->next;
		free(head);
		printf("成功删除");
	} 
	else {
	head=head->next;
		while(head) {
			if(head->elecode!=n) {
				head=head->next;
				nextp=nextp->next;
			} else
				break;
		}
		if(head==NULL)
			printf("错误编码");
		else {
			
			nextp->next=head->next;
			free(head);
			printf("成功删除");
		}
	}
	getchar();
	getchar();
	system("cls");
}

void save(struct med *p) {
	FILE* fp;
	fp = fopen(".\\medinfo.txt", "w");
	while (p) {
		fprintf(fp,"%d %s %.2lf %s %d %d %d\n",p->elecode,p->name,p->price,p->type,p->prod,p->shelf,p->stock);

		p = p->next;
	}
	fclose(fp);
	printf("保存成功\n");
	getchar();
	getchar();
	system("cls");
}

void read() {
	if(p!=NULL) {
		struct med *nextp=p->next;
		free(p);
		while(nextp) {
			p=nextp;
			nextp=nextp->next;
			free(p);
		}
	}
	FILE *fp;
	fp=fopen(".\\medinfo.txt","r");
	if(fp==NULL) {
		printf("文件无法打开");
	} else {
		struct med *nextp,*head;
		head=NULL;
		nextp=(struct med*)malloc(sizeof(struct med));
		nextp->next=NULL;
		while(fscanf(fp,"%d",&nextp->elecode)==1) {
			fscanf(fp,"%s",nextp->name);
			fscanf(fp,"%lf",&nextp->price);
			fscanf(fp,"%s",&nextp->type);
			fscanf(fp,"%d",&nextp->prod);
			fscanf(fp,"%d",&nextp->shelf);
			fscanf(fp,"%d",&nextp->stock);
			if(head==NULL) {
				head=nextp;
				p=head;
			} else {
				head->next=nextp;
				head=head->next;
			}
			nextp=(struct med*)malloc(sizeof(struct med));
			nextp->next=NULL;
		}
		fclose(fp);
	}
	getchar();
	getchar();
	system("cls");
}
```